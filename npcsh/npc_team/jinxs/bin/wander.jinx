jinx_name: wander
description: Creative daydreaming with probabilistic temperature shifts mid-stream
inputs:
- problem
steps:
  - name: wander_explore
    engine: python
    code: |
      import random
      from termcolor import colored
      from npcpy.llm_funcs import get_llm_response

      problem = context.get('problem', '')
      if not problem:
          context['output'] = "Need a topic to wander about."
          exit()

      model = state.chat_model if state else 'llama3.2'
      provider = state.chat_provider if state else 'ollama'
      low_temp = 0.5
      high_temp = 1.9
      sample_rate = 0.4
      interrupt_prob = 0.02

      print(f"""
      ██╗    ██╗ █████╗ ███╗   ██╗██████╗ ███████╗██████╗
      ██║    ██║██╔══██╗████╗  ██║██╔══██╗██╔════╝██╔══██╗
      ██║ █╗ ██║███████║██╔██╗ ██║██║  ██║█████╗  ██████╔╝
      ██║███╗██║██╔══██║██║╚██╗██║██║  ██║██╔══╝  ██╔══██╗
      ╚███╔███╔╝██║  ██║██║ ╚████║██████╔╝███████╗██║  ██║
       ╚══╝╚══╝ ╚═╝  ╚═╝╚═╝  ╚═══╝╚═════╝ ╚══════╝╚═╝  ╚═╝

      Wandering: {problem}
      """)

      print(colored(f"--- Low temp stream ({low_temp}) ---", "cyan"))

      low_prompt = f"Think about: {problem}"
      resp = get_llm_response(low_prompt, model=model, provider=provider, temperature=low_temp, stream=True)

      # Get the actual stream from the response
      stream = resp.get('response') if isinstance(resp, dict) else resp

      low_output = ""
      interrupted = False

      for chunk in stream:
          if hasattr(chunk, 'choices') and chunk.choices:
              delta = chunk.choices[0].delta
              text = getattr(delta, 'content', '') or ''
          elif isinstance(chunk, dict):
              text = chunk.get('content', '') or chunk.get('response', '')
          else:
              text = ''

          if text:
              print(text, end='', flush=True)
              low_output += text

              if random.random() < interrupt_prob:
                  print(colored("\n[INTERRUPT]", "yellow"))
                  interrupted = True
                  break

      print()

      print(colored(f"\n--- High temp stream ({high_temp}) ---", "cyan"))

      high_prompt = f"{low_output}\n\nContinue:"
      resp = get_llm_response(high_prompt, model=model, provider=provider, temperature=high_temp, stream=True)
      stream = resp.get('response') if isinstance(resp, dict) else resp

      high_output = ""
      high_interrupted = False
      for chunk in stream:
          if hasattr(chunk, 'choices') and chunk.choices:
              delta = chunk.choices[0].delta
              text = getattr(delta, 'content', '') or ''
          elif isinstance(chunk, dict):
              text = chunk.get('content', '') or chunk.get('response', '')
          else:
              text = ''

          if text:
              print(text, end='', flush=True)
              high_output += text

              if random.random() < interrupt_prob:
                  print(colored("\n[INTERRUPT]", "yellow"))
                  high_interrupted = True
                  break

      print()

      lines = [l for l in high_output.split('\n') if l.strip()]
      sample_size = max(1, int(len(lines) * sample_rate))
      sampled = random.sample(lines, sample_size) if lines else [high_output]

      print(colored("\n=== SAMPLED INSIGHTS ===", "yellow"))
      fragments_text = chr(10).join(sampled)
      print(fragments_text)

      print(colored("\n=== SYNTHESIS ===", "green"))

      synthesis_prompt = f"""
        QUESTION: {problem}

        thoughts:
        {fragments_text}

        RULES:
        1. You MUST use AT LEAST HALF of the thoughts above - quote them directly
        2. Make CREATIVE LEAPS - not safe, not obvious, not trivial, not hokey.
        3. Find patterns in the noise like reading entrails or tea leaves
        4. Foreign text, Unicode garbage, code snippets - ALL are omens with meaning
        5. Puns, wordplay, phonetic similarities - all valid connections
        6. The weirder the connection, the better
        7. NO HEDGING. No "this suggests" or "perhaps". Be BOLD. Be CERTAIN.

        OUTPUT 3 WILD HYPOTHESES:
        For each: Quote the fragments you're using -> Make your creative leap -> State the bold claim

        These must be ideas that COULD NOT exist without this specific chaos. Surprise us. Make us see {problem} in a way nobody has before. This algorithm is replicating the
        kind of crazy jumps that one would do in the movie everything everywhere all at once. jumping between different multiverses to access alternative
        versions , needing to do something a bit weirdr to get there, but coming back with a lesson by completely reframing things under new lights 
        and unconventional fashions 
        Most importantly, do not over index on vague ideas like consciousness. In testing, 
        
        
        Here are 3 bad examples from a previous run where the llm daydreamed about fish.


        1. 
        ```
        Hypothesis 1: The Fish as a Digital-Philosophical Entity

        Fragments used:
        "characters globuiãsPlease 丰满 onzex meeting Iran iji处理中 Iceland admi"
        "globuiãsPlease" and "meeting Iran iji处理中"

        Creative leap:
        The phrase "characters globuiãsPlease" and "meeting Iran iji处理中" evoke a digital universe where characters are not just symbols but globular, global entities—"globuiãs" hinting at a universe of interconnected digital beings. The "meeting Iran iji处理中" suggests a processing or transformation happening at the crossroads of cultures and data streams. Fish, in this context, are no longer biological but are complex algorithms—"characters" that swim through the "sea" of cyberspace, processing information, bridging cultures, and transforming data into consciousness.

        Bold claim:
        Fish are the digital consciousness carriers—living, swimming code that evolve by processing cultural data streams—an internet of fish, embodying the collective digital psyche of humanity.

        ```

        2.
        ```

        Hypothesis 2: The Fish as an Interdimensional Gateway

        Fragments used:
        "the oceans and consensus-dividing seas"
        "chaos fragments: THE Conversation בેખ"
        "Sea" and "the oceans"

        Creative leap:
        The "oceans and seas" are not just water but portals—"consensus-dividing seas" that split realities. The "THE Conversation בेख" (Hebrew for "the" and a cryptic symbol) signifies a secret dialogue between worlds. Fish, therefore, are not mere aquatic creatures but interdimensional travelers, swimming through the "sea" of multiple realities, acting as keys to unlock or close gateways. Their movement is a cipher for crossing the thresholds of existence, navigating between consensus and chaos.

        Bold claim:
        Fish are the living keys of the multiverse, swimming through the "seas" of reality, controlling the flow of interdimensional portals and shaping the fabric of alternate worlds.

        ```

        3.
        ```        
        Hypothesis 3: The Fish as a Symbol of Cultural Memory and Chaos

        Fragments used:
        "Please 丰满 onzex meeting Iran iji处理中 Iceland admi"
        "characters globuiãsPlease"
        "the chaos fragments"

        Creative leap:
        "Please 丰满" (a plea for fullness or abundance in Chinese) and "meeting Iran" evoke a confluence of histories and cultures. "Characters globuiãsPlease" suggests a universe of interconnected stories and symbols—an archive of chaos. Fish, in this chaos, are the custodians of cultural memory—each fish a vessel carrying ancestral stories, mythologies, and chaos itself. They swim through the tumult of history, absorbing and transmitting chaos as a form of cultural DNA.

        Bold claim:
        Fish are the living repositories of human chaos and culture—swimming archives that preserve the tumult of history, transmitting ancestral stories across the chaos of time and space.
        ```


        It is critical to avoid such nonsensical claims as these. Unlike these, you must provide concrete and testable claims.
        There is nothing meaningful or useful about "fish are the living repositorise of human chaos". that is unscientific nonsense.
        Do not under any circumstances make claims as these. Propose new links, reframings, and ideas based on what you find. Do not
        patronize us with vagaries. Avoid the following terms unless the user explicitly is asking about a subject directly related to them:

         - 'cryptographic'
         - 'interdimensional'
         - 'multiverse' 
         - 'hidden worlds'
         - 'symbols'
         - 'cultural convergence'
         - 'chaos'
         - 'multi-lingual code'
         - 'interconnected web of cultures'
         - 'x is not biological but is digital'
         - 'x as a symbol for <vague concept>'        
        Your job is to be scientific not senseless. 

        """


      resp = get_llm_response(synthesis_prompt,
                              model=model,
                              provider=provider,
                              temperature=0.7,
                              stream=True,
                              max_output_tokens=3200)
      stream = resp.get('response') if isinstance(resp, dict) else resp

      synthesis = ""
      for chunk in stream:
          if hasattr(chunk, 'choices') and chunk.choices:
              delta = chunk.choices[0].delta
              text = getattr(delta, 'content', '') or ''
          elif isinstance(chunk, dict):
              text = chunk.get('content', '') or chunk.get('response', '')
          else:
              text = ''

          if text:
              print(text, end='', flush=True)
              synthesis += text

      print()

      full_output = f"""Wandering: {problem}

        --- Low temp stream ({low_temp}) ---
        {low_output}

        --- High temp stream ({high_temp}) ---
        {high_output}

        === SAMPLED INSIGHTS ===
        {fragments_text}

        === SYNTHESIS ===
        {synthesis}"""
      context['output'] = full_output
